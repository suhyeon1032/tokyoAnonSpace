<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ìº˜ë¦°ë” ê²Œì‹œíŒ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
          background-color: #fff9e6; /* í¬ë¦¼ìƒ‰ ë°°ê²½ */
          font-family: 'Pretendard', 'Noto Sans KR', sans-serif;
          color: #5a3a00;
        }

        .navbar {
          background-color: transparent;
          padding: 1rem 4rem;
        }

        .navbar-brand {
          background-color: #ffd54f;
          color: #5a3a00;
          font-weight: bold;
          border-radius: 10px;
          padding: 0.5rem 1rem;
        }

        .navbar-nav .nav-link {
          color: #5a3a00;
          font-weight: 600;
          margin-right: 1rem;
        }

        .navbar-nav .nav-link:hover {
          color: #c68c00;
        }
        .calendar-section {
          background-color: white;
          border-radius: 15px;
          padding: 40px;
          margin-top: 40px;
          max-width: 1000px;
          margin-left: auto;
          margin-right: auto;
          box-shadow: 0 3px 8px rgba(0,0,0,0.05);
        }

        .calendar-title {
          font-weight: bold;
          font-size: 2rem;
          color: #3E2723;
          text-align: center;
          margin-bottom: 30px;
        }

        .calendar-controls {
          text-align: center;
          margin-bottom: 20px;
        }

        table.calendar {
          width: 100%;
          table-layout: fixed;
          border-collapse: collapse;
        }
        th, td {
          text-align: center;
          height: 90px;
          vertical-align: top;
          border: 1px solid #f7e9b0;
        }
        th {
          background-color: #ffe082;
          font-weight: bold;
        }

        .day {
          display: inline-flex;
          align-items: center;
          justify-content: center;
          width: 34px;
          height: 34px;
          border-radius: 50%;
          transition: background-color 0.2s ease;
        }
        .day:hover {
          background-color: #FFD54F;
          color: white;
          cursor: pointer;
        }

        .memo-list {
          font-size: 0.85rem;
          margin-top: 4px;
          color: #444;
          text-align: left;
          padding-left: 4px;
        }
    </style>


</head>
<body>

<!-- ë„¤ë¹„ê²Œì´ì…˜ -->
<nav class="navbar navbar-expand-lg">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">LOGO</a>
        <div class="ms-3 fw-bold">ì»¤ë®¤ë‹ˆí‹°</div>
        <div class="collapse navbar-collapse justify-content-end">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link" href="#">í™ˆ</a></li>
                <li class="nav-item"><a class="nav-link" href="#">ê³µì§€ê²Œì‹œíŒ</a></li>
                <li class="nav-item"><a class="nav-link" href="#">ììœ ê²Œì‹œíŒ</a></li>
                <li class="nav-item"><a class="nav-link" href="/calendar">ìº˜ë¦°ë”</a></li>
            </ul>
        </div>
    </div>
</nav>

<!-- Calendar Section -->
<main class="calendar-section">
    <h1 class="text-center mb-4">ìº˜ë¦°ë” ê²Œì‹œíŒ</h1>

    <div class="calendar-controls text-center mb-3">
        <select id="yearSelect" class="form-select d-inline-block w-auto"></select>
        <select id="monthSelect" class="form-select d-inline-block w-auto ms-2"></select>
        <button id="showCalendar" class="btn btn-warning ms-2">ë³´ê¸°</button>
    </div>

    <table class="calendar">
        <thead>
        <tr><th>ì¼</th><th>ì›”</th><th>í™”</th><th>ìˆ˜</th><th>ëª©</th><th>ê¸ˆ</th><th>í† </th></tr>
        </thead>
        <tbody id="calendar-body"></tbody>
    </table>
</main>

<!-- Modal -->
<div class="modal fade" id="memoModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">ì¼ì • ì¶”ê°€</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p id="selected-date" class="fw-bold mb-2"></p>
                <textarea id="memoInput" class="form-control" rows="3" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
                <button type="button" class="btn btn-warning" id="saveMemo">ì €ì¥</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const calendarBody = document.getElementById("calendar-body");
    const modal = new bootstrap.Modal(document.getElementById('memoModal'));
    const memoInput = document.getElementById("memoInput");
    const selectedDate = document.getElementById("selected-date");
    let activeDate = null;
    let currentYear, currentMonth;

    const today = new Date();
    currentYear = today.getFullYear();
    currentMonth = today.getMonth();

    const yearSelect = document.getElementById("yearSelect");
    const monthSelect = document.getElementById("monthSelect");
    for (let y = currentYear - 5; y <= currentYear + 5; y++) {
      const option = new Option(y + "ë…„", y, y === currentYear);
      yearSelect.appendChild(option);
    }
    for (let m = 0; m < 12; m++) {
      const option = new Option((m + 1) + "ì›”", m, m === currentMonth);
      monthSelect.appendChild(option);
    }

    document.getElementById("showCalendar").addEventListener("click", () => {
      currentYear = parseInt(yearSelect.value);
      currentMonth = parseInt(monthSelect.value);
      loadCalendar();
    });

    async function loadCalendar() {
      const res = await fetch(`/api/calendar/${currentYear}/${currentMonth + 1}`);
      const events = await res.json();
      generateCalendar(currentYear, currentMonth, events);
    }

    function generateCalendar(year, month, events) {
      calendarBody.innerHTML = "";
      const firstDay = new Date(year, month, 1).getDay();
      const lastDate = new Date(year, month + 1, 0).getDate();
      let date = 1;

      for (let i = 0; i < 6; i++) {
        let row = document.createElement("tr");
        for (let j = 0; j < 7; j++) {
          let cell = document.createElement("td");
          if (i === 0 && j < firstDay) cell.innerHTML = "";
          else if (date > lastDate) break;
          else {
            // ìˆ˜ì • ì½”ë“œ (ë‘ ìë¦¬ë¡œ 0íŒ¨ë”©)
const cellDate = `${year}-${String(month + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
            cell.innerHTML = `<div class="day" data-date="${cellDate}">${date}</div>`;

            const memoList = events.filter(e => e.date === cellDate);
            memoList.forEach(ev => {
              const memoDiv = document.createElement("div");
              memoDiv.className = "memo-list";
              memoDiv.innerText = "â€¢ " + ev.content;
              cell.appendChild(memoDiv);
            });

            date++;
          }
          row.appendChild(cell);
        }
        calendarBody.appendChild(row);
      }

      document.querySelectorAll(".day").forEach(day => {
  day.addEventListener("click", async e => {
    activeDate = e.target.dataset.date;
    selectedDate.textContent = activeDate;

    // ğŸŸ¡ ê¸°ì¡´ ì¼ì • ë¶ˆëŸ¬ì˜¤ê¸°
    const res = await fetch(`/api/calendar/day/${activeDate}`);
    const events = await res.json();

    // ì²« ë²ˆì§¸ ì¼ì •ì´ ìˆìœ¼ë©´ ë‚´ìš© í‘œì‹œ (ì—†ìœ¼ë©´ ë¹ˆì¹¸)
    if (events.length > 0) {
      memoInput.value = events.map(ev => ev.content).join("\n");
    } else {
      memoInput.value = "";
    }

    modal.show();
  });
});
    }

    document.getElementById("saveMemo").addEventListener("click", async () => {
  const content = memoInput.value.trim();

  // âœ… ë°±ì—”ë“œì—ì„œ ë¹ˆì¹¸ ì—¬ë¶€ë¥¼ íŒë‹¨í•˜ë„ë¡, ë¬´ì¡°ê±´ ìš”ì²­ ë³´ëƒ„
  await fetch("/api/calendar/add", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ date: activeDate, content })
  });

  modal.hide();
  loadCalendar();
});

    loadCalendar();
    document.addEventListener("DOMContentLoaded", () => {
      // í˜„ì¬ ì—°ë„/ì›” ê¸°ë³¸ê°’ìœ¼ë¡œ ë¡œë“œ
      currentYear = today.getFullYear();
      currentMonth = today.getMonth();
      yearSelect.value = currentYear;
      monthSelect.value = currentMonth;
      loadCalendar();
    });
</script>
</body>
</html>
